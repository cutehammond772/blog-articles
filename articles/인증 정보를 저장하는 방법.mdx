---
tag: ["보안", "프론트엔드", "인증/인가"]
createdDate: 2024-03-07
modifiedDate: 2024-03-07
---

# Authorization Scenario

## 인증 정보를 저장하는 방법

사용자가 홈페이지를 누비는 동안, 뒷편에서는 (특정 사용자에 대한) 인증 정보를 최대한 안전하면서도 **사용자에게 불편이 없도록** 유지시켜야 하는 임무가 있습니다. 마냥 정보를 저장하고 두기에는 보안 상에 문제가 생길 확률이 높고, 인증 정보의 갱신이 겉으로 주기적으로 드러나면 사용자 경험 상 좋지 않겠지요.

따라서, 우리는 인증 정보를 최대한 주기적으로 fresh한 상태로 유지하되 사용자가 최대한 알아채지 못하도록 갱신되도록 코드를 작성하려고 합니다. 그렇다면, 이러한 시나리오에 필요한 구성은 어떤 것이 있을까요?

- 인증 정보
- 인증 정보를 담을 저장소
- 인증 정보 갱신 시퀀스
- 인증 권한 확인(및 식별)

일단, 기본적으로 위의 네 가지를 먼저 떠올릴 수 있습니다. 좀 더 깊이 따져보면,

- 인증 정보

1. 어떤 정보를 포함해야 할까요?
2. 이러한 정보는 특정 권한을 가진 사용자임을 입증하기에 충분할까요?
3. 보안적인 이슈에 안전할까요?

- 인증 정보를 담을 저장소

1. 어떤 저장소에 저장해야 할까요?
2. 해당 저장소에 접근할 수 있는 대상은 누가 있나요?
3. 제3자로부터의 탈취 이슈에 안전한가요?

- 인증 정보 갱신 시퀀스

1. 갱신은 어디서 이뤄져야 할까요?
2. 인증 정보가 갱신되면, 현재 권한이 필요한 루틴이나 정보들은 어떻게 해야 할까요?
3. 갱신 주기는 어느 정도로 잡아야 할까요?

- 인증 권한 확인(및 식별)

1. 해당 권한을 확인하는 주체는 어디일까요?

---

먼저, 클라이언트에 저장할 정보는 Access Token과 ID로 한정한다. Refresh Token은 HttpOnly Secure Cookie로 설정되었고, 이는 서버에서만 직접 접근할 수 있도록 의도하였다.

굳이 저 둘로 나눈 이유는 무엇일까? 이 이유에 대해 알아보기 전에 우리가 직접 홈페이지를 들어가면서 겪는 경험에 대해 살펴볼 필요가 있다.

- 홈페이지에 접속했을 때, 홈페이지가 로드되면서 인증 정보를 서버로부터 가져오려고 시도한다. 이후, Access Token과 ID를 가져온다.
- 인증 정보가 필요한 컴포넌트는 이 ID를 토대로 사용자 정보를 가져온다.
- 로그아웃 시에는 이 두 정보가 사라지면서 컴포넌트도 이 결과를 반영한다.
- Access Token이 만료되기 전 재검증을 진행 후, Access Token을 교체한다.

이때, 만약 Access Token 만으로 인증을 관리하였다면 재검증 시퀀스에도 컴포넌트가 반응하였을 것이다. 이는 렌더 코스트의 증가와 더불어 직접적인 인증 정보에 대한 의존도 증가로 이어진다.

인증 정보가 필요한 컴포넌트는 세가지 케이스로 나뉜다.

- 특정 사용자의 정보를 단순히 가져오는 데 필요한 경우
- 위의 케이스에서, 민감한 정보를 가져올 필요가 있는 경우
- 특정 요청이 인증이 필요한 경우

먼저, 첫번째 케이스는 Access Token 필요 없이 ID만 있으면 충분하다.

두번째 케이스의 경우, 첫번째 케이스에서 처음 데이터를 불러올 때만 구체적인 인증 과정이 필요하다.

세번째 케이스의 경우, 항상 Access Token에 대한 의존성이 필요하다.

즉, 첫번째와 두번째 케이스는 컴포넌트가 유지되는 도중에는 Access Token의 의존성이 필요하지 않다. 그렇다면, 이러한 의존성 분리를 구체적으로 어떻게 달성해야 할까?

## Memoized Component로 나타내기

첫번째와 두번째 케이스의 경우, 컴포넌트가 유지되는 중에는 ID에만 의존해도 상관없다.

> 두번째 케이스에 대해 의문을 가질 수도 있다. 하지만, 맨 처음 인증 과정을 위조할 수 없기 때문에 안전하다고 할 수 있다.

그렇다면, Access Token에 대한 의존성을 어떻게 분리할까? 필자는 별도의 Container를 두고 내부에 Memoized Component를 둠으로써 해결하고자 한다.

특정 Container가 처음 렌더될 때에는, 구체적인 인증 정보를 가지고 요청 후 결과를 특정 컴포넌트에 전달 후 memoize 한다.
